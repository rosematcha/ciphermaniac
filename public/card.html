<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Card Details - Pokemon TCG Analysis | Ciphermaniac</title>
    <meta
      name="description"
      content="View detailed Pokemon TCG card statistics including usage rates, deck inclusion, copy counts, and price data across tournaments."
    />
    <meta
      name="keywords"
      content="Pokemon TCG card, card usage stats, deck inclusion, Pokemon card price, PTCG card analysis"
    />

    <!-- Canonical URL - dynamic pages use JS to set this -->
    <link rel="canonical" href="https://ciphermaniac.com/cards" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://ciphermaniac.com/cards" />
    <meta property="og:title" content="Card Details - Pokemon TCG Analysis" />
    <meta
      property="og:description"
      content="View detailed Pokemon TCG card statistics including usage rates and deck inclusion."
    />
    <meta property="og:image" content="https://ciphermaniac.com/assets/images/og-image.png" />
    <meta property="og:site_name" content="Ciphermaniac" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="https://ciphermaniac.com/cards" />
    <meta name="twitter:title" content="Card Details - Pokemon TCG" />
    <meta name="twitter:description" content="View detailed Pokemon TCG card statistics and usage data." />
    <meta name="twitter:image" content="https://ciphermaniac.com/assets/images/og-image.png" />

    <!-- Favicon - PNG for Google compatibility -->
    <link rel="icon" type="image/png" sizes="48x48" href="/assets/images/favicon-48x48.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon-16x16.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <meta name="theme-color" content="#fee475" />

    <!-- DNS prefetch for external resources -->
    <link rel="dns-prefetch" href="https://limitlesstcg.nyc3.cdn.digitaloceanspaces.com" />
    <!-- Preload critical font to reduce layout shift -->
    <link rel="preload" href="/assets/fonts/fraunces.woff2" as="font" type="font/woff2" crossorigin />
    <link rel="stylesheet" href="/assets/style.css" />
    <!-- Preload critical JS modules for faster page load -->
    <link rel="modulepreload" href="/assets/js/src/card.js" />
    <link rel="modulepreload" href="/assets/js/src/api.js" />
    <link rel="modulepreload" href="/assets/js/src/card/charts.js" />
  </head>
  <body>
    <!-- Search toolbar (minimal, card-only) -->
    <div class="toolbar" role="search" aria-label="Card search">
      <div class="toolbar-inner">
        <div class="controls card-search">
          <div class="search-wrap">
            <svg class="search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path
                d="M21 21l-4.35-4.35"
                stroke="#7c86a8"
                stroke-width="1.6"
                stroke-linecap="round"
                stroke-linejoin="round"
              ></path>
              <circle
                cx="11"
                cy="11"
                r="6"
                stroke="#7c86a8"
                stroke-width="1.6"
                stroke-linecap="round"
                stroke-linejoin="round"
              ></circle>
            </svg>
            <input
              id="card-search"
              type="search"
              placeholder="Search database&hellip;"
              autocomplete="off"
              aria-label="Search database"
            />
            <datalist id="card-names"></datalist>
            <div id="card-suggestions" class="suggestions" role="listbox" aria-label="Card suggestions"></div>
          </div>
        </div>
      </div>
    </div>

    <main id="main-content" tabindex="-1">
      <section id="card-meta" class="card-sect" aria-labelledby="card-title">
        <div class="header-title">
          <div class="title-row">
            <h1 id="card-title"></h1>
            <div id="card-price" class="card-price">
              <!-- Price loads asynchronously -->
            </div>
          </div>
        </div>
        <div id="card-hero" class="card-hero">
          <!-- Hero image container - populated by JS with smooth fade-in -->
          <div class="thumb" aria-hidden="true">
            <div
              class="skeleton-image"
              style="
                width: 100%;
                height: 100%;
                background: var(--bar-bg);
                animation: skeleton-loading 1.5s ease-in-out infinite;
              "
            ></div>
          </div>
        </div>
        <div id="card-center">
          <!-- window-select removed; card page always shows the most recent 6 tournaments -->
          <div id="card-chart" role="img" aria-label="Usage chart across tournaments">
            <!-- Chart loads asynchronously with smooth transition -->
          </div>
          <div id="card-copies" role="img" aria-label="Copy count distribution histogram">
            <!-- Histogram loads asynchronously with smooth transition -->
          </div>
        </div>
        <div id="card-events"></div>
        <!-- Card meta-share and copy count graph will go here -->
      </section>
      <section id="card-analysis" class="card-sect" aria-labelledby="analysis-heading">
        <div class="analysis-header">
          <h2 id="analysis-heading">In-Depth Analysis</h2>
          <div class="controls">
            <label for="analysis-event">
              Event:
              <select id="analysis-event" aria-label="Select tournament event for analysis"></select>
            </label>
          </div>
        </div>
        <div id="analysis-table" style="margin-top: 8px" role="region" aria-label="Analysis data table"></div>
      </section>
    </main>
    <!-- Modal will be injected by JS when needed -->

    <script>
      // Fast synchronous title update - no module imports, immediate paint
      (function () {
        function getInitialCardLabel() {
          const params = new URLSearchParams(location.search);
          const q = params.get('name');
          if (q) return q;

          const hashMatch = location.hash.match(/^#card\/(.+)$/);
          if (hashMatch) return decodeURIComponent(hashMatch[1]);

          const pathMatch = location.pathname.match(/\/card(?:\.html)?(?:\/([^/?#]+))?$/i);
          if (pathMatch && pathMatch[1]) {
            // Minimal inline describeSlug for initial paint
            const slug = decodeURIComponent(pathMatch[1]);
            return slug.replace(/-/g, ' ').replace(/\b\w/g, c => c.toUpperCase());
          }
          return null;
        }

        const initialLabel = getInitialCardLabel();
        if (initialLabel) {
          const titleEl = document.getElementById('card-title');
          if (titleEl) {
            let primary = initialLabel;
            let setInfo = '';

            if (initialLabel.includes('::')) {
              const parts = initialLabel.split('::');
              primary = parts[0] || initialLabel;
              if (parts[1] && parts[2]) {
                setInfo = parts[1] + ' ' + parts[2];
              }
            } else {
              // Try to parse "Name SET NUMBER" format
              const match = initialLabel.match(/^(.+?)\s+([A-Z]+\s+\d+[A-Za-z]?)$/);
              if (match) {
                primary = match[1];
                setInfo = match[2];
              }
            }

            // Check if primary is just a set ID pattern (e.g., "SVI 181" or "Svi~181")
            const setIdPattern = /^[A-Z]{2,4}[\s~]\d+[A-Za-z]?$/i;
            if (setIdPattern.test(primary)) {
              // Can't resolve the actual name without async data, show as-is for now
              // The module script will fix it with proper card data
              setInfo = primary.replace(/~/g, ' ');
              primary = ''; // Will show loading state
            }

            titleEl.innerHTML = '';

            if (primary) {
              const nameSpan = document.createElement('span');
              nameSpan.className = 'card-title-name';
              nameSpan.textContent = primary;
              titleEl.appendChild(nameSpan);

              if (setInfo) {
                const setSpan = document.createElement('span');
                setSpan.className = 'card-title-set';
                setSpan.textContent = setInfo;
                titleEl.appendChild(setSpan);
              }

              document.title = `${primary} – Ciphermaniac`;
            } else {
              // Show a placeholder that will be replaced by the module
              const nameSpan = document.createElement('span');
              nameSpan.className = 'card-title-name';
              nameSpan.textContent = 'Loading...';
              titleEl.appendChild(nameSpan);
              document.title = 'Card Details – Ciphermaniac';
            }
          }
        }
      })();
    </script>
    <script type="module">
      // Defer header/footer until after initial content paint
      import { createHeader } from '/assets/js/src/components/header.js';
      import { createFooter } from '/assets/js/src/components/footer.js';

      const header = createHeader({ currentPage: 'cards' });
      const footer = createFooter();

      document.body.insertAdjacentElement('afterbegin', header);
      document.body.insertAdjacentElement('beforeend', footer);
    </script>
    <script src="/assets/js/src/card.js" type="module"></script>
  </body>
</html>
